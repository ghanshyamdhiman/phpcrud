


<html>
    <head>
<title> Test</title>

<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
<script src="js/jquery.min.js"></script>

<link rel="stylesheet" href="css/bootstrap.min.css">
<script src="js/bootstrap.min.js"></script>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

<script src="js/sweetalert2.all.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<link rel="stylesheet" type="text/css" href="DataTables/datatables.min.css"/>
<script type="text/javascript" src="DataTables/datatables.min.js"></script>


<link href="https://cdn.datatables.net/v/dt/dt-1.13.8/datatables.min.css" rel="stylesheet">
 
<script src="https://cdn.datatables.net/v/dt/dt-1.13.8/datatables.min.js"></script>

</head>
<body>
    <h1>Data Tables Testing</h1>
<div class="top-panel">
    <a href="javascript:void(0);" class="btn btn-primary" onclick="addData()">Add New User</a>
</div>

<!-- Data list table -->
<table id="dataList" class="display" style="width:100%">
    <thead>
        <tr>
            <th>First name</th>
            <th>Last name</th>
            <th>Email</th>
            <th>Gender</th>
            <th>Country</th>
            <th>Created</th>
            <th>Status</th>
            <th>Action</th>
        </tr>
    </thead>
    <tfoot>
        <tr>
            <th>First name</th>
            <th>Last name</th>
            <th>Email</th>
            <th>Gender</th>
            <th>Country</th>
            <th>Created</th>
            <th>Status</th>
            <th>Action</th>
        </tr>
    </tfoot>
</table>
<div class="modal fade" id="userDataModal" tabindex="-1" aria-labelledby="userAddEditModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="userModalLabel">Add New User</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form name="userDataFrm" id="userDataFrm">
            <div class="modal-body">
                <div class="frm-status"></div>
                <div class="mb-3">
                    <label for="userFirstName" class="form-label">First Name</label>
                    <input type="text" class="form-control" id="userFirstName" placeholder="Enter firstname">
                </div>
                <div class="mb-3">
                    <label for="userLastName" class="form-label">Last Name</label>
                    <input type="text" class="form-control" id="userLastName" placeholder="Enter lastname">
                </div>
                <div class="mb-3">
                    <label for="userEmail" class="form-label">Email address</label>
                    <input type="email" class="form-control" id="userEmail" placeholder="Enter email">
                </div>
                <div class="form-radio">
                    <label>Gender:</label>
                    <input type="radio" name="userGender" id="userGender_1" value="Male" checked> Male 
                    &nbsp;&nbsp; 
                    <input type="radio" name="userGender" id="userGender_2" value="Female"> Female
                </div>
                <div class="mb-3">
                    <label for="userCountry" class="form-label">Country</label>
                    <input type="text" class="form-control" id="userCountry" placeholder="Enter country">
                </div>
                <div class="form-radio">
                    <label>Status:</label>
                    <input type="radio" name="userStatus" id="userStatus_1" value="1" checked> Active &nbsp;&nbsp;
                    <input type="radio" name="userStatus" id="userStatus_2" value="0"> Inactive
                </div>
            </div>
            <div class="modal-footer">
                <input type="hidden" id="userID" value="0">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="submitUserData()">Submit</button>
            </div>
            </form>
        </div>
    </div>
</div>



<script>



var table = $('#dataList').DataTable({
    "processing": true,
    "serverSide": true,
    "ajax": "fetchData.php",
    "columnDefs": [
        { "orderable": false, "targets": 7 }
    ]
});

$(document).ready(function(){
    // Draw the table
    table.draw();
});


function addData(){
    $('.frm-status').html('');
    $('#userModalLabel').html('Add New User');

   $('#fsr_id').val('');
	$('#fsr_date').val('');
	$('#fsr_slot').val('');
	$('#fsr_sch_fm').val('');
	$('#fsr_sch_till').val('');
	$('#faculty').val('');
	$('#lec_type').val('');
	$('#act_code').val('');
	$('#batch').val('');
	$('#room').val('');
	$('#chap_code').val('');
	$('#fac_time_in').val('');
	$('#fac_time_out').val('');
	$('#attn_by').val('');
	$('#attn_by_in').val('');
	$('#attn_by_out').val('');
	$('#remarks').val('');
    $('#userDataModal').modal('show');
}

function editData(user_data){
    $('.frm-status').html('');
    $('#userModalLabel').html('Edit User #'+user_data.id);

   	$('#fsr_id').val(user_data.fsr_id);
	$('#fsr_date').val(user_data.fsr_date);
	$('#fsr_slot').val(user_data.fsr_slot);
	$('#fsr_sch_fm').val(user_data.fsr_sch_fm);
	$('#fsr_sch_till').val(user_data.fsr_sch_till);
	$('#faculty').val(user_data.faculty);
	$('#lec_type').val(user_data.lec_type);
	$('#act_code').val(user_data.act_code);
	$('#batch').val(user_data.batch);
	$('#room').val(user_data.room);
	$('#chap_code').val(user_data.chap_code);
	$('#fac_time_in').val(user_data.fac_time_in);
	$('#fac_time_out').val(user_data.fac_time_out);
	$('#attn_by').val(user_data.attn_by);
	$('#attn_by_in').val(user_data.attn_by_in);
	$('#attn_by_out').val(user_data.attn_by_out);
	$('#remarks').val(user_data.remarks);
    $('#userDataModal').modal('show');
}

function submitUserData(){
    $('.frm-status').html('');
    let input_data_arr = [
        document.getElementById('fsr_id').value,
	document.getElementById('fsr_date').value,
	document.getElementById('fsr_slot').value,
	document.getElementById('fsr_sch_fm').value,
	document.getElementById('fsr_sch_till').value,
	document.getElementById('faculty').value,
	document.getElementById('lec_type').value,
	document.getElementById('act_code').value,
	document.getElementById('batch').value,
	document.getElementById('room').value,
	document.getElementById('chap_code').value,
	document.getElementById('fac_time_in').value,
	document.getElementById('fac_time_out').value,
	document.getElementById('attn_by').value,
	document.getElementById('attn_by_in').value,
	document.getElementById('attn_by_out').value,
	document.getElementById('remarks').value,
    ];

    fetch("eventHandler.php", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ request_type:'addEditUser', user_data: input_data_arr}),
    })
    .then(response => response.json())
    .then(data => {
        if (data.status == 1) {
            Swal.fire({
                title: data.msg,
                icon: 'success',
            }).then((result) => {
                // Redraw the table
	        table.draw();

                $('#userDataModal').modal('hide');
                $("#userDataFrm")[0].reset();
            });
        } else {
            $('.frm-status').html('<div class="alert alert-danger" role="alert">'+data.error+'</div>');
        }
    })
    .catch(console.error);
}


function deleteData(user_id){
    Swal.fire({
        title: 'Are you sure to Delete?',
        text:'You won\'t be able to revert this!',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, delete it!'
      }).then((result) => {
        if (result.isConfirmed) {
          // Delete event
          fetch("eventHandler.php", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ request_type:'deleteUser', user_id: user_id}),
          })
          .then(response => response.json())
          .then(data => {
            if (data.status == 1) {
                Swal.fire({
                    title: data.msg,
                    icon: 'success',
                }).then((result) => {
                    table.draw();
                });
            } else {
              Swal.fire(data.error, '', 'error');
            }
          })
          .catch(console.error);
        } else {
          Swal.close();
        }
    });
}

</script>
</body>
</html>
